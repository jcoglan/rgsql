#!/usr/bin/env node

const net = require('net')
const split = require('split2')

const Engine = require('../lib/engine')
const Server = require('../lib/server')

const PORT = 3003

let engine = new Engine()
let server = new Server(engine)

let tcp = net.createServer(async (sock) => {
  let requests = sock.pipe(split('\0'))

  for await (let msg of requests) {
    let reply = await server.handle(msg)
    sock.write(JSON.stringify(reply) + '\0')
  }
})

tcp.listen(PORT)
